local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local Teams = game:GetService("Teams")

local localPlayer = Players.LocalPlayer
local target = nil
local aiming = false
local espEnabled = false
local aimbotEnabled = false

-- Configurações ajustadas
local aimKey = Enum.UserInputType.MouseButton2
local toggleESPKey = Enum.KeyCode.Q
local toggleAimbotKey = Enum.KeyCode.E
local fovRadius = 50

local targetPart = "Head" -- Parte padrão para mirar

-- Desenho do círculo do FOV
local fovCircle = Drawing.new("Circle")
fovCircle.Visible = false
fovCircle.Color = Color3.new(1, 1, 0)
fovCircle.Thickness = 2
fovCircle.Filled = false
fovCircle.Radius = fovRadius
fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

-- Função para criar GUI
local function createGui()
    local screenGui = Instance.new("ScreenGui", game.Players.LocalPlayer:WaitForChild("PlayerGui"))
    screenGui.Name = "AimbotGui"

    local frame = Instance.new("Frame", screenGui)
    frame.Size = UDim2.new(0, 200, 0, 150)
    frame.Position = UDim2.new(0.5, -100, 0.5, -75)
    frame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    frame.BorderSizePixel = 0

    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Text = "Select Target Part"
    title.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    title.TextColor3 = Color3.new(1, 1, 1)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 16

    local headButton = Instance.new("TextButton", frame)
    headButton.Size = UDim2.new(1, -20, 0, 30)
    headButton.Position = UDim2.new(0, 10, 0, 40)
    headButton.Text = "Head"
    headButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
    headButton.TextColor3 = Color3.new(1, 1, 1)
    headButton.Font = Enum.Font.SourceSans
    headButton.TextSize = 14

    local torsoButton = Instance.new("TextButton", frame)
    torsoButton.Size = UDim2.new(1, -20, 0, 30)
    torsoButton.Position = UDim2.new(0, 10, 0, 80)
    torsoButton.Text = "Torso"
    torsoButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
    torsoButton.TextColor3 = Color3.new(1, 1, 1)
    torsoButton.Font = Enum.Font.SourceSans
    torsoButton.TextSize = 14

    local closeButton = Instance.new("TextButton", frame)
    closeButton.Size = UDim2.new(1, -20, 0, 30)
    closeButton.Position = UDim2.new(0, 10, 0, 120)
    closeButton.Text = "Close"
    closeButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
    closeButton.TextColor3 = Color3.new(1, 1, 1)
    closeButton.Font = Enum.Font.SourceSans
    closeButton.TextSize = 14

    headButton.MouseButton1Click:Connect(function()
        targetPart = "Head"
        print("Mira definida para a cabeça.")
    end)

    torsoButton.MouseButton1Click:Connect(function()
        targetPart = "HumanoidRootPart"
        print("Mira definida para o torso.")
    end)

    closeButton.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)
end

-- Função para encontrar o jogador mais próximo no FOV
local function findTarget()
    local closestPlayer = nil
    local shortestDistance = math.huge

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild(targetPart) then
            local part = player.Character:FindFirstChild(targetPart)

            if part then
                local screenPosition, onScreen = Camera:WorldToViewportPoint(part.Position)
                local distance = (part.Position - Camera.CFrame.Position).magnitude

                if onScreen and distance < shortestDistance and (Vector2.new(screenPosition.X, screenPosition.Y) - Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)).Magnitude < fovRadius then
                    closestPlayer = player
                    shortestDistance = distance
                    target = player
                end
            end
        end
    end

    return closestPlayer
end

-- Função do aimbot
local function aimbot()
    if aiming and target then
        local part = target.Character:FindFirstChild(targetPart)
        if part then
            local targetPosition = part.Position
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPosition)
        end
    end
end

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Zero then
        createGui()
    end

    if input.KeyCode == toggleESPKey then
        espEnabled = not espEnabled
        if espEnabled then
            print("ESP ativado.")
        else
            print("ESP desativado.")
        end
    end

    if input.KeyCode == toggleAimbotKey then
        aimbotEnabled = not aimbotEnabled
        if aimbotEnabled then
            print("Aimbot ativado.")
        else
            print("Aimbot desativado.")
            aiming = false
            target = nil
        end
    end

    if input.UserInputType == aimKey and aimbotEnabled then
        target = findTarget()
        aiming = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == aimKey then
        aiming = false
        target = nil
    end
end)

RunService.RenderStepped:Connect(function()
    fovCircle.Position = UserInputService:GetMouseLocation()
    if aimbotEnabled then
        aimbot()
    end
end)
